- alias: fermer les volets du salon quand la nuit tombe et que je suis a la maison
  trigger:
    platform: numeric_state
    entity_id: sun.sun
    value_template: '{{ state.attributes.elevation }}'
    below: 0.2
  condition:
    - condition: state
      entity_id: input_boolean.volets
      state: 'on'
    - condition: state
      entity_id: device_tracker.cc61e5bfb0cb
      state: 'home'
    - condition: state
      entity_id: input_boolean.vacances
      state: 'off'
  action:
    - service: switch.turn_off
      entity_id: switch.volet_salon
    - service: switch.turn_off
      entity_id: switch.volet_chambre

- alias: fermer les volets du salon si le mode vacance est active
  trigger:
    platform: numeric_state
    entity_id: sun.sun
    value_template: '{{ state.attributes.elevation }}'
    below: 0.2
  condition:
    - condition: state
      entity_id: input_boolean.vacances
      state: 'on'
  action:
    - service: switch.turn_off
      entity_id: switch.volet_salon
    - service: switch.turn_off
      entity_id: switch.volet_chambre

- alias: ouvrir les volets du salon quand le jour se leve et que je suis a la maison
  trigger:
    platform: sun
    event: sunrise
  condition:
    - condition: state
      entity_id: input_boolean.volets
      state: 'on'
    - condition: state
      entity_id: input_boolean.guest_mode
      state: 'off'
    - condition: state
      entity_id: device_tracker.cc61e5bfb0cb
      state: 'home'
  action:
    service: switch.turn_on
    entity_id: switch.volet_salon

- alias: Fermer les volets si je ne suis pas a la maison
  hide_entity: true
  trigger:
    platform: numeric_state
    entity_id: sun.sun
    value_template: '{{ state.attributes.elevation }}'
    below: 0.2
  condition:
    - condition: state
      entity_id: input_boolean.volets
      state: 'on'
    - condition: state
      entity_id: device_tracker.cc61e5bfb0cb
      state: 'not_home'
    - condition: state
      entity_id: input_boolean.vacances
      state: 'off'
  action:
    - service: notify.notifier_seb
      data:
        message: 'Monsieur, Voulez vous fermer les volets ?'
        data:
          keyboard:
            - '/Fermer'
            - '/Laisser'

- alias: 'Confirmation de fermeture si je ne suis pas a la maison'
  trigger:
    platform: event
    event_type: telegram_command
    event_data:
      command: '/Fermer'
  action:
    - service: switch.turn_off
      entity_id: switch.volet_salon
    - service: switch.turn_off
      entity_id: switch.volet_chambre
    - service: notify.notifier_seb
      data:
        message: 'Les volets sont fermés.'

- alias: 'Confirmation que ha laisse ouvert si je ne suis pas a la maison'
  trigger:
    platform: event
    event_type: telegram_command
    event_data:
      command: '/Laisser'
  action:
    - service: notify.notifier_seb
      data:
        message: 'Les volets sont restés ouverts.'

- alias: fermer en partie les volets si trop chaud
  trigger:
    platform: state
    entity_id: sensor.broadlinklight 
    to: 'lumineux'
  condition:
    - condition: state
      entity_id: input_boolean.volets
      state: 'on'
    - condition: numeric_state
      entity_id: sensor.broadlink_sensor_temperature
      above: 27.0
  action:
    - service: switch.turn_off
      entity_id: switch.volet_salon
    - delay:
        seconds: 15
    - service: switch.turn_off
      entity_id: switch.volet_salon

